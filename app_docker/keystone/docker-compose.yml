# Copyright (c) 2020, 2021, Oracle and/or its affiliates.
# Contributor: Trong Nhan Mai

version: '2.0'

services:

  mongo:
    image: mongo
    user: mongodb
    restart: always
    expose:
      - 27017

  web:
    image:
      docker.pkg.github.com/skyworld42/nodejsfuzzing/keystone:v1
    restart: always
    depends_on:
      - mongo
    environment:
      MONGO_URI: mongodb://mongo:27017
      KEYSTONEJS_HOST: 0.0.0.0
    command: sh -c "sleep 5 && node ./node_modules/express-instrument-app/bin/run --projectDir ./test/e2e/ --logFile log.file --enable-coverage server.js"
    ports:
      - "3000:3000"